<!doctype html>
<html lang="fa">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Team Shuffle â€” Ø«Ø¨Øª ØªÛŒÙ… âš½</title>
<link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;500;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg-dark:#031022; --card:#071424;
  --accent-blue:#0077f0; --accent-yellow:#ffd100; --accent-red:#ff5252; --accent-green:#00d27a;
  --muted:#9fb0d6;
}
*{box-sizing:border-box;font-family:'Vazirmatn',sans-serif}
html,body{height:100%;margin:0;background:#000;color:#eaf2ff}
.bg-field{
  position:fixed;inset:0;z-index:-1;
  background: url('bg.jpg') center/cover no-repeat;
  filter: brightness(.45);
}
.app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px}
.container{width:100%;max-width:980px}
.card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px;padding:16px;box-shadow:0 24px 60px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.02)}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.title{font-weight:800;color:var(--accent-yellow);font-size:20px}
.grid{display:grid;grid-template-columns:1fr 380px;gap:12px}
@media (max-width:860px){ .grid{grid-template-columns:1fr} }
.splash{position:fixed;inset:0;z-index:60;display:flex;align-items:center;justify-content:center;flex-direction:column;background:linear-gradient(180deg,rgba(2,10,26,0.96),rgba(2,10,26,0.9));transition:opacity .45s ease;backdrop-filter: blur(4px)}
.splash.hidden{opacity:0;pointer-events:none}
.ball{font-size:140px;animation:shrink 1s cubic-bezier(.2,.9,.2,1) forwards}
@keyframes shrink{0%{transform:scale(2.2);opacity:0}20%{opacity:1}100%{transform:scale(1);opacity:1}}
.form-row{margin-bottom:10px}
input[type="text"]{width:100%;padding:12px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:inherit;font-size:15px}
.roles{display:flex;gap:8px;margin-bottom:8px}
.role{flex:1;padding:10px;border-radius:8px;text-align:center;cursor:pointer;border:2px solid transparent;background:rgba(255,255,255,0.01);user-select:none}
.role.active{box-shadow:0 10px 28px rgba(0,0,0,0.6)}
.role.player.active{border-color:var(--accent-blue)}
.role.gk.active{border-color:var(--accent-green)}
.btn{display:inline-block;padding:10px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent-blue),var(--accent-green));color:#001218;font-weight:700;cursor:pointer;width:100%}
.small{padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer}
.list{background:rgba(255,255,255,0.02);padding:10px;border-radius:8px;max-height:360px;overflow:auto;margin-top:8px}
ul{list-style:none;padding:0;margin:0}
li{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:8px;margin-bottom:8px;background:rgba(0,0,0,0.05)}
.badge{font-size:12px;padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03)}
.footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
.reset-btn{padding:10px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent-red),var(--accent-yellow));color:#001;font-weight:800;border:none;cursor:pointer}
.modal-back{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:80}
.modal{background:linear-gradient(180deg,#071428,#06121d);padding:14px;border-radius:10px;width:340px;box-shadow:0 18px 44px rgba(0,0,0,0.7);border:1px solid rgba(255,255,255,0.03)}
.modal h4{margin:0 0 8px 0;color:var(--accent-yellow)}
.modal input{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.02);color:inherit;margin-bottom:8px}
.small-note{font-size:12px;color:var(--muted)}
.counter{font-weight:800;color:var(--accent-yellow)}
</style>
</head>
<body>
<div class="bg-field"></div>

<div class="splash" id="splash">
  <div class="ball">âš½</div>
  <div style="color:var(--accent-yellow);font-weight:800;margin-top:12px">Team Shuffle</div>
</div>

<div class="app">
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="title">âš½ Team Shuffle</div>
        <div class="small-note">Ø¯Ùˆ ØªÛŒÙ… â€” Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø¢ÙÙ„Ø§ÛŒÙ†</div>
      </div>

      <div class="grid">
        <!-- left: register -->
        <div>
          <div style="font-weight:700;margin-bottom:8px">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</div>

          <div id="step-name">
            <div class="form-row">
              <input id="nameInput" type="text" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù…â€ŒØ®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ (ÙØ§Ø±Ø³ÛŒ ÛŒØ§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ)" />
            </div>
            <div class="form-row">
              <button id="toRole" class="btn">Ø§Ø¯Ø§Ù…Ù‡</button>
            </div>
          </div>

          <div id="step-role" style="display:none">
            <div style="font-weight:700;margin-bottom:8px">Ù†Ù‚Ø´</div>
            <div class="roles">
              <div id="rolePlayer" class="role player" data-role="player">âš½ Ø¨Ø§Ø²ÛŒÚ©Ù†</div>
              <div id="roleGk" class="role gk" data-role="gk">ğŸ§¤ Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†</div>
            </div>
            <div>
              <button id="registerBtn" class="btn">Ø«Ø¨Øª</button>
            </div>
          </div>

          <div id="msg" style="margin-top:10px;display:none;padding:8px;border-radius:8px"></div>

          <div style="margin-top:12px" class="small-note">Ù¾Ø³ Ø§Ø² Ø«Ø¨Øª Ù†Ø§Ù…ØŒ Ø§Ø³Ù… Ø´Ù…Ø§ Ø¯Ø± Ù„ÛŒØ³Øª Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ùˆ Ø§Ù…Ú©Ø§Ù† Ø«Ø¨Øª Ø¯ÙˆØ¨Ø§Ø±Ù‡ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ ØªØ§ Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø§Ø¯Ù…ÛŒÙ† Ø±ÛŒØ³Øª Ú©Ù†Ø¯.</div>
        </div>

        <!-- right: lists -->
        <div>
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700;color:var(--accent-yellow)">Ù„ÛŒØ³Øª Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡â€ŒÙ‡Ø§</div>
            <div class="counter" id="count">0</div>
          </div>

          <div class="list" id="rawList"></div>

          <div style="height:10px"></div>

          <div style="font-weight:700;color:var(--accent-yellow)">ØªÛŒÙ…â€ŒÙ‡Ø§</div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:8px">
            <div class="list" style="padding:8px">
              <div style="font-weight:700">ğŸ”µ ØªÛŒÙ… A</div>
              <ul id="teamA"></ul>
              <div style="font-size:13px;color:var(--muted);margin-top:6px">ØªØ¹ÙˆÛŒØ¶ÛŒâ€ŒÙ‡Ø§ÛŒ A</div>
              <ul id="subsA"></ul>
            </div>
            <div class="list" style="padding:8px">
              <div style="font-weight:700">ğŸ”´ ØªÛŒÙ… B</div>
              <ul id="teamB"></ul>
              <div style="font-size:13px;color:var(--muted);margin-top:6px">ØªØ¹ÙˆÛŒØ¶ÛŒâ€ŒÙ‡Ø§ÛŒ B</div>
              <ul id="subsB"></ul>
            </div>
          </div>

          <div class="footer" style="margin-top:10px">
            <div class="small-note">Ø­Ø¯Ø§Ú©Ø«Ø± Ù‡Ø± ØªÛŒÙ…: Ûµ Ù†ÙØ± (Ø´Ø§Ù…Ù„ GK)</div>
            <button id="resetBtn" class="reset-btn">ğŸ” Reset (Ø§Ø¯Ù…ÛŒÙ†)</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- admin modal -->
<div id="modal" class="modal-back">
  <div class="modal">
    <h4>Ø±Ù…Ø² Ù…Ø¯ÛŒØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯</h4>
    <input id="adminInput" type="password" placeholder="Ø±Ù…Ø²" />
    <div id="adminError" style="color:var(--accent-red);display:none;margin-bottom:8px;font-size:13px"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px">
      <button id="cancelAdmin" class="small">Ø§Ù†ØµØ±Ø§Ù</button>
      <button id="confirmAdmin" class="btn">ØªØ§ÛŒÛŒØ¯</button>
    </div>
  </div>
</div>

<script>
/* Thin, final client-side offline implementation
   - Put your background image file as bg.jpg next to this HTML
   - Admin password (client-side offline): admin12345
*/
const ADMIN_PASSWORD = 'admin12345';
const KEY_PLAYERS = 'TS_PLAYERS_V1';
const KEY_DEVICE = 'TS_DEVICE_ID_V1';

function makeDeviceId(){
  let id = localStorage.getItem(KEY_DEVICE);
  if(!id){
    id = Date.now().toString(36) + Math.random().toString(36).slice(2,8);
    localStorage.setItem(KEY_DEVICE, id);
  }
  return id;
}
const DEVICE_ID = makeDeviceId();

function loadPlayers(){ try{ const r = localStorage.getItem(KEY_PLAYERS); return r?JSON.parse(r):[] }catch(e){return[]} }
function savePlayers(a){ localStorage.setItem(KEY_PLAYERS, JSON.stringify(a)) }
function clearPlayers(){ localStorage.removeItem(KEY_PLAYERS) }

function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } }

function assignTwo(players){
  // returns {teamA, teamB, subsA, subsB}
  const gks = players.filter(p=>p.role==='gk').slice();
  const field = players.filter(p=>p.role==='player').slice();
  shuffle(gks); shuffle(field);

  const teamA = [], teamB = [], subsA = [], subsB = [];

  if(gks.length>0) teamA.push(gks.shift());
  if(gks.length>0) teamB.push(gks.shift());

  let turn = 0;
  for(const p of field){
    const aSize = teamA.length;
    const bSize = teamB.length;
    if(aSize < 5 && bSize < 5){
      if(turn % 2 === 0) teamA.push(p); else teamB.push(p);
      turn++;
    } else if(aSize < 5){
      teamA.push(p);
    } else if(bSize < 5){
      teamB.push(p);
    } else {
      // both full -> assign to smaller subs
      if(subsA.length <= subsB.length) subsA.push(p); else subsB.push(p);
    }
  }

  // leftover gks -> subs (distribute)
  while(gks.length>0){
    const p = gks.shift();
    if(subsA.length <= subsB.length) subsA.push(p); else subsB.push(p);
  }

  // balance diff <=1 by moving players (not GK) if needed
  let safety = 0;
  while(Math.abs(teamA.length - teamB.length) > 1 && safety < 40){
    if(teamA.length > teamB.length){
      const idx = teamA.findIndex(x=>x.role==='player');
      if(idx>=0){ const moved = teamA.splice(idx,1)[0]; teamB.push(moved); }
      else break;
    } else {
      const idx = teamB.findIndex(x=>x.role==='player');
      if(idx>=0){ const moved = teamB.splice(idx,1)[0]; teamA.push(moved); }
      else break;
    }
    safety++;
  }

  return { teamA, teamB, subsA, subsB };
}

/* UI wiring */
const splash = document.getElementById('splash');
setTimeout(()=>splash.classList.add('hidden'),1000);

const toRole = document.getElementById('toRole');
const nameInput = document.getElementById('nameInput');
const stepName = document.getElementById('step-name');
const stepRole = document.getElementById('step-role');
const rolePlayer = document.getElementById('rolePlayer');
const roleGk = document.getElementById('roleGk');
const registerBtn = document.getElementById('registerBtn');
const msg = document.getElementById('msg');

const rawList = document.getElementById('rawList');
const countEl = document.getElementById('count');
const teamAEl = document.getElementById('teamA');
const teamBEl = document.getElementById('teamB');
const subsAEl = document.getElementById('subsA');
const subsBEl = document.getElementById('subsB');

let selectedRole = null;

toRole.addEventListener('click', ()=>{
  if((nameInput.value||'').trim()===''){ showMsg('Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯','err'); return; }
  stepName.style.display='none';
  stepRole.style.display='block';
});

[rolePlayer,roleGk].forEach(el=>{
  el.addEventListener('click', ()=>{
    [rolePlayer,roleGk].forEach(x=>x.classList.remove('active'));
    el.classList.add('active'); selectedRole = el.dataset.role;
  });
});

registerBtn.addEventListener('click', ()=>{
  const name = (nameInput.value||'').trim();
  if(!name){ showMsg('Ù†Ø§Ù… Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯','err'); return; }
  if(!selectedRole){ showMsg('Ù†Ù‚Ø´ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯','err'); return; }
  const players = loadPlayers();
  if(players.some(p=>p.deviceId===DEVICE_ID)){ showMsg('Ø§ÛŒÙ† Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù‚Ø¨Ù„Ø§Ù‹ Ø«Ø¨Øª Ø´Ø¯Ù‡','err'); return; }
  const entry = { id: Date.now().toString(36)+Math.random().toString(36).slice(2,6), deviceId: DEVICE_ID, name, role: selectedRole };
  players.push(entry); savePlayers(players);
  nameInput.value=''; [rolePlayer,roleGk].forEach(x=>x.classList.remove('active')); selectedRole=null;
  stepRole.style.display='none'; stepName.style.display='block';
  showMsg('Ø«Ø¨Øª Ø´Ø¯ âœ…','ok');
  render();
});

function showMsg(t, type){
  msg.style.display='block'; msg.textContent=t;
  msg.style.background = type==='ok'? 'linear-gradient(90deg, rgba(0,210,122,0.06), rgba(0,179,255,0.04))' : 'rgba(255,75,75,0.06)';
  msg.style.color = type==='ok'? 'var(--accent-green)': 'var(--accent-red)';
  setTimeout(()=> msg.style.display='none',3000);
}

function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

function render(){
  const players = loadPlayers();
  rawList.innerHTML='';
  if(players.length===0) rawList.innerHTML = '<div style="color:var(--muted)">Ù‡ÛŒÚ†â€ŒÚ©Ø³ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡</div>';
  else players.forEach(p=>{
    const li = document.createElement('li');
    li.innerHTML = `<span>${escapeHtml(p.name)}</span><span class="badge">${p.role==='gk'?'ğŸ§¤':'âš½'}</span>`;
    rawList.appendChild(li);
  });
  countEl.textContent = players.length;

  const res = assignTwo(players);
  // clear teams
  teamAEl.innerHTML = ''; teamBEl.innerHTML = ''; subsAEl.innerHTML=''; subsBEl.innerHTML='';
  if(res.teamA.length===0) teamAEl.innerHTML='<li style="color:var(--muted)">â€”</li>'; else res.teamA.forEach(p=>{ const li=document.createElement('li'); li.innerHTML=`<span>${escapeHtml(p.name)}</span><span class="badge">${p.role==='gk'?'ğŸ§¤':'âš½'}</span>`; teamAEl.appendChild(li); });
  if(res.teamB.length===0) teamBEl.innerHTML='<li style="color:var(--muted)">â€”</li>'; else res.teamB.forEach(p=>{ const li=document.createElement('li'); li.innerHTML=`<span>${escapeHtml(p.name)}</span><span class="badge">${p.role==='gk'?'ğŸ§¤':'âš½'}</span>`; teamBEl.appendChild(li); });
  if(res.subsA.length===0) subsAEl.innerHTML='<li style="color:var(--muted)">â€”</li>'; else res.subsA.forEach(p=>{ const li=document.createElement('li'); li.innerHTML=`<span>${escapeHtml(p.name)}</span><span class="badge">ğŸ”</span>`; subsAEl.appendChild(li); });
  if(res.subsB.length===0) subsBEl.innerHTML='<li style="color:var(--muted)">â€”</li>'; else res.subsB.forEach(p=>{ const li=document.createElement('li'); li.innerHTML=`<span>${escapeHtml(p.name)}</span><span class="badge">ğŸ”</span>`; subsBEl.appendChild(li); });
}

render();

/* admin reset */
const resetBtn = document.getElementById('resetBtn');
const modal = document.getElementById('modal');
const adminInput = document.getElementById('adminInput');
const confirmAdmin = document.getElementById('confirmAdmin');
const cancelAdmin = document.getElementById('cancelAdmin');
const adminError = document.getElementById('adminError');

resetBtn.addEventListener('click', ()=>{ adminInput.value=''; adminError.style.display='none'; modal.style.display='flex'; setTimeout(()=>adminInput.focus(),120); });
cancelAdmin.addEventListener('click', ()=>{ modal.style.display='none'; adminError.style.display='none'; });

confirmAdmin.addEventListener('click', ()=>{
  const v = (adminInput.value||'').trim();
  if(!v){ adminError.textContent='Ø±Ù…Ø² Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯'; adminError.style.display='block'; return; }
  if(v !== ADMIN_PASSWORD){ adminError.textContent='Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª'; adminError.style.display='block'; return; }
  clearPlayers();
  modal.style.display='none';
  showMsg('ÙÙ‡Ø±Ø³Øª Ù¾Ø§Ú© Ø´Ø¯','ok');
  render();
});
</script>
</body>
</html>
