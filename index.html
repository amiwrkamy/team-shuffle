<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team Draft</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:Vazirmatn, sans-serif;
background:radial-gradient(circle at top,#1e3c72,#0f2027);
color:#fff;
min-height:100vh;
}
.container{
max-width:420px;
margin:auto;
padding:15px;
}
.header{
text-align:center;
margin-bottom:15px;
}
.header h1{
margin:0;
font-size:26px;
letter-spacing:1px;
}
.admin{
display:flex;
gap:10px;
margin-bottom:15px;
}
.admin button{
flex:1;
background:linear-gradient(135deg,#ff512f,#dd2476);
color:#fff;
border:none;
padding:12px;
border-radius:14px;
font-weight:bold;
box-shadow:0 10px 25px rgba(0,0,0,.4);
}
.card{
background:rgba(255,255,255,.1);
backdrop-filter:blur(14px);
border-radius:22px;
padding:20px;
box-shadow:0 20px 50px rgba(0,0,0,.6);
margin-bottom:15px;
transform-style:preserve-3d;
}
.card:hover{
transform:translateY(-3px);
transition:.3s;
}
input,button{
width:100%;
padding:14px;
border:none;
border-radius:14px;
font-size:15px;
}
input{margin-top:10px}
button.main{
background:linear-gradient(135deg,#00c6ff,#0072ff);
color:#fff;
font-weight:bold;
margin-top:12px;
box-shadow:0 10px 30px rgba(0,114,255,.6);
}
.roles{
display:flex;
gap:10px;
margin-top:10px;
}
.roles label{
flex:1;
background:#fff;
color:#000;
padding:10px;
border-radius:12px;
text-align:center;
font-weight:bold;
}
.team h3{text-align:center}
li{
background:rgba(255,255,255,.15);
margin-top:6px;
padding:8px;
border-radius:10px;
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>âš½ Team Draft</h1>
</div>

<div class="admin">
<button onclick="adminReset()">Ø±ÛŒØ³Øª</button>
<button onclick="adminShuffle()">Ø´Ø§Ù†Ø³ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
</div>

<div id="form" class="card">
<input id="name" placeholder="Ù†Ø§Ù… Ø¨Ø§Ø²ÛŒÚ©Ù†">
<div class="roles">
<label><input type="radio" name="role" value="player" checked> Ø¨Ø§Ø²ÛŒÚ©Ù†</label>
<label><input type="radio" name="role" value="goalkeeper"> Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†</label>
</div>
<button class="main" onclick="register()">Ø«Ø¨Øª Ù†Ø§Ù…</button>
</div>

<div class="card team">
<h3>ØªÛŒÙ… A</h3>
<ul id="A"></ul>
<h3>ØªÛŒÙ… B</h3>
<ul id="B"></ul>
</div>

</div>

<script>
const firebaseConfig = {
apiKey:"XXXX",
authDomain:"XXXX",
projectId:"XXXX"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const ADMIN="admin12345";

const deviceId=localStorage.id||(localStorage.id=Math.random().toString(36));

const initTeams=async()=>{
await db.doc("teams/A").set({gk:null,p:[],s:[]},{merge:true});
await db.doc("teams/B").set({gk:null,p:[],s:[]},{merge:true});
};
initTeams();

db.collection("meta").doc("lock").get().then(d=>{
if(d.exists && d.data()[deviceId]) form.classList.add("hidden");
});

db.collection("teams").onSnapshot(render);

async function register(){
const n=name.value.trim();
if(!n) return alert("Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†");

const r=document.querySelector('input[name=role]:checked').value;
const teams=["A","B"].sort(()=>Math.random()-.5);

for(let t of teams){
let ref=db.doc("teams/"+t);
let doc=await ref.get();
let d=doc.data();

if(r=="goalkeeper" && !d.gk){
d.gk=n+" ðŸ§¤";
await ref.set(d);
lock(); return;
}
if(r=="player"){
if(d.p.length<5){d.p.push(n);await ref.set(d);lock();return;}
else{d.s.push(n+" ðŸ”„");await ref.set(d);lock();return;}
}
}
alert("Ø¸Ø±ÙÛŒØª Ù¾Ø±Ù‡");
}

function lock(){
db.doc("meta/lock").set({[deviceId]:true},{merge:true});
form.classList.add("hidden");
}

function render(snap){
["A","B"].forEach(x=>document.getElementById(x).innerHTML="");
snap.forEach(d=>{
let t=d.id,dt=d.data(),ul=document.getElementById(t);
if(dt.gk) ul.innerHTML+=`<li>${dt.gk}</li>`;
dt.p.forEach(x=>ul.innerHTML+=`<li>${x}</li>`);
dt.s.forEach(x=>ul.innerHTML+=`<li>${x}</li>`);
});
}

function adminReset(){
if(prompt("Ø±Ù…Ø²")!==ADMIN) return;
db.collection("teams").get().then(q=>q.forEach(d=>d.ref.set({gk:null,p:[],s:[]})));
db.doc("meta/lock").delete();
location.reload();
}

function adminShuffle(){
if(prompt("Ø±Ù…Ø²")!==ADMIN) return;
adminReset();
}
</script>
</body>
</html>
