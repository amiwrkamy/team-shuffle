<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team Randomizer</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
margin:0;
font-family:sans-serif;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:#fff;
}
.container{max-width:420px;margin:auto;padding:15px}
.card{
background:rgba(255,255,255,.08);
backdrop-filter:blur(12px);
border-radius:18px;
padding:20px;
box-shadow:0 15px 40px rgba(0,0,0,.5);
margin-bottom:15px
}
h2,h3{text-align:center}
input,button{
width:100%;
padding:12px;
margin-top:10px;
border:none;
border-radius:12px;
font-size:15px
}
button{background:#00d2ff;font-weight:bold}
.radio{display:flex;gap:10px;margin-top:10px}
.radio label{
flex:1;
background:#fff;
color:#000;
padding:10px;
border-radius:10px;
text-align:center
}
.top{display:flex;gap:10px}
ul{list-style:none;padding:0}
li{
background:rgba(255,255,255,.15);
margin-top:6px;
padding:8px;
border-radius:8px
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div class="top">
<button onclick="adminReset()">Ø±ÛŒØ³Øª</button>
<button onclick="adminShuffle()">Ø´Ø§Ù†Ø³ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
</div>

<div id="form" class="card">
<h2>Ø«Ø¨Øª Ù†Ø§Ù…</h2>
<input id="name" placeholder="Ù†Ø§Ù…">
<div class="radio">
<label><input type="radio" name="role" value="player" checked> Ø¨Ø§Ø²ÛŒÚ©Ù†</label>
<label><input type="radio" name="role" value="goalkeeper"> Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†</label>
</div>
<button onclick="register()">Ø«Ø¨Øª</button>
</div>

<div class="card">
<h3>ØªÛŒÙ… A</h3>
<ul id="A"></ul>
<h3>ØªÛŒÙ… B</h3>
<ul id="B"></ul>
</div>

</div>

<script>
// ðŸ”¥ Firebase Config Ø®ÙˆØ¯Øª
const firebaseConfig = {
apiKey: "XXXX",
authDomain: "XXXX",
projectId: "XXXX",
storageBucket: "XXXX",
messagingSenderId: "XXXX",
appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const ADMIN="admin12345";

const deviceId = localStorage.deviceId || 
(localStorage.deviceId = Math.random().toString(36).slice(2));

db.collection("meta").doc("lock").get().then(d=>{
if(d.exists && d.data()[deviceId]) form.classList.add("hidden");
});

db.collection("teams").onSnapshot(render);

function register(){
const n=name.value.trim();
if(!n) return alert("Ù†Ø§Ù…ØŸ");
const r=document.querySelector('input[name=role]:checked').value;

db.runTransaction(async t=>{
const A=await t.get(db.doc("teams/A"));
const B=await t.get(db.doc("teams/B"));
let teams=[A,B].sort(()=>Math.random()-0.5);

for(let tm of teams){
let d=tm.data()||{gk:null,p:[],s:[]};
if(r=="goalkeeper" && !d.gk){
d.gk=n+" (GK)";
t.set(tm.ref,d); lock(); return;
}
if(r=="player"){
if(d.p.length<5){d.p.push(n);t.set(tm.ref,d);lock();return;}
else{d.s.push(n+" (ØªØ¹ÙˆÛŒØ¶ÛŒ)");t.set(tm.ref,d);lock();return;}
}
}
alert("Ø¬Ø§ÛŒÛŒ Ù†ÛŒØ³Øª");
});
}

function lock(){
db.doc("meta/lock").set({[deviceId]:true},{merge:true});
form.classList.add("hidden");
}

function render(snap){
["A","B"].forEach(id=>document.getElementById(id).innerHTML="");
snap.forEach(doc=>{
let d=doc.data(),ul=document.getElementById(doc.id);
if(d.gk) ul.innerHTML+=`<li>${d.gk}</li>`;
d.p?.forEach(x=>ul.innerHTML+=`<li>${x}</li>`);
d.s?.forEach(x=>ul.innerHTML+=`<li>${x}</li>`);
});
}

function adminReset(){
if(prompt("Ø±Ù…Ø²")!==ADMIN) return;
db.collection("teams").get().then(q=>q.forEach(d=>d.ref.delete()));
db.doc("meta/lock").delete();
}

function adminShuffle(){
if(prompt("Ø±Ù…Ø²")!==ADMIN) return;
adminReset();
}
</script>
</body>
</html>
