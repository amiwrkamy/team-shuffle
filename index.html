<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Team Randomizer</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
margin:0;
font-family:sans-serif;
background:linear-gradient(135deg,#141e30,#243b55);
color:#fff;
}
.container{max-width:420px;margin:auto;padding:15px}
.card{
background:rgba(255,255,255,.1);
backdrop-filter:blur(14px);
border-radius:22px;
padding:20px;
box-shadow:0 20px 40px rgba(0,0,0,.6);
margin-bottom:15px;
}
h2,h3{text-align:center}

/* ðŸ”¥ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¯ÛŒÙ†Ø§Ù…ÛŒÚ©ÛŒ */
button{
width:100%;
padding:14px;
border:none;
border-radius:16px;
font-size:15px;
font-weight:bold;
cursor:pointer;
background:linear-gradient(135deg,#00c6ff,#0072ff);
color:#fff;
box-shadow:0 10px 25px rgba(0,114,255,.6);
transition:.2s;
}
button:active{
transform:scale(.95);
box-shadow:0 5px 15px rgba(0,114,255,.8);
}
button:hover{filter:brightness(1.1)}

input{
width:100%;
padding:14px;
border-radius:14px;
border:none;
margin-top:10px;
}
.roles{
display:flex;
gap:10px;
margin-top:10px;
}
.roles label{
flex:1;
background:#fff;
color:#000;
padding:10px;
border-radius:12px;
text-align:center;
}
.top{
display:flex;
gap:10px;
margin-bottom:10px;
}
ul{list-style:none;padding:0}
li{
background:rgba(255,255,255,.15);
margin-top:6px;
padding:8px;
border-radius:10px;
}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">

<div class="top">
<button onclick="adminReset()">Ø±ÛŒØ³Øª</button>
<button onclick="adminShuffle()">Ø´Ø§Ù†Ø³ÛŒ Ø¯ÙˆØ¨Ø§Ø±Ù‡</button>
</div>

<div id="form" class="card">
<h2>Ø«Ø¨Øª Ù†Ø§Ù…</h2>
<input id="name" placeholder="Ù†Ø§Ù…">
<div class="roles">
<label><input type="radio" name="role" value="player" checked> Ø¨Ø§Ø²ÛŒÚ©Ù†</label>
<label><input type="radio" name="role" value="goalkeeper"> Ø¯Ø±ÙˆØ§Ø²Ù‡â€ŒØ¨Ø§Ù†</label>
</div>
<button onclick="register()">Ø«Ø¨Øª</button>
</div>

<div class="card">
<h3>ØªÛŒÙ… A</h3>
<ul id="A"></ul>
<h3>ØªÛŒÙ… B</h3>
<ul id="B"></ul>
</div>

</div>

<script>
const firebaseConfig={
apiKey:"XXXX",
authDomain:"XXXX",
projectId:"XXXX"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();
const ADMIN="admin12345";

const deviceId=localStorage.did||(localStorage.did=Math.random().toString(36));

async function init(){
await db.doc("teams/A").set({gk:null,p:[],s:[]},{merge:true});
await db.doc("teams/B").set({gk:null,p:[],s:[]},{merge:true});
}
init();

db.doc("meta/lock").get().then(d=>{
if(d.exists && d.data()[deviceId]) form.classList.add("hidden");
});

db.collection("teams").onSnapshot(render);

async function register(){
const n=name.value.trim();
if(!n) return alert("Ù†Ø§Ù… ÙˆØ§Ø±Ø¯ Ú©Ù†");

const r=document.querySelector('input[name=role]:checked').value;
const order=["A","B"].sort(()=>Math.random()-.5);

for(let t of order){
let ref=db.doc("teams/"+t);
let d=(await ref.get()).data();

if(r==="goalkeeper" && !d.gk){
d.gk=n+" ðŸ§¤";
await ref.set(d);
lock();return;
}
if(r==="player"){
if(d.p.length<5){d.p.push(n);await ref.set(d);lock();return;}
else{d.s.push(n+" ðŸ”„");await ref.set(d);lock();return;}
}
}
alert("Ø¸Ø±ÙÛŒØª Ù¾Ø±Ù‡");
}

function lock(){
db.doc("meta/lock").set({[deviceId]:true},{merge:true});
form.classList.add("hidden");
}

function render(snap){
["A","B"].forEach(x=>document.getElementById(x).innerHTML="");
snap.forEach(doc=>{
let d=doc.data(),ul=document.getElementById(doc.id);
if(d.gk) ul.innerHTML+=`<li>${d.gk}</li>`;
d.p.forEach(x=>ul.innerHTML+=`<li>${x}</li>`);
d.s.forEach(x=>ul.innerHTML+=`<li>${x}</li>`);
});
}

function adminReset(){
if(prompt("Ø±Ù…Ø²")!==ADMIN) return;
["A","B"].forEach(t=>db.doc("teams/"+t).set({gk:null,p:[],s:[]}));
db.doc("meta/lock").delete();
location.reload();
}

function adminShuffle(){
if(prompt("Ø±Ù…Ø²")!==ADMIN) return;
adminReset();
}
</script>
</body>
</html>
